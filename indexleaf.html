<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>å¤¢è¦‹ãƒ¶å´å‹•ç‰©å‹‡è€…å›£MAP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Leaflet æ ·å¼ -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    body, html { margin: 0; padding: 0; height: 100%; }
    #map { height: 100vh; }
  </style>
</head>
<body>

<!-- åœ°å›¾å®¹å™¨ -->
<div id="map"></div>

<!-- Leaflet è„šæœ¬ -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // ğŸ”— Google Apps Script è¾“å‡ºçš„ JSON æ•°æ®é“¾æ¥
  const DATA_URL = "https://script.google.com/macros/s/AKfycbzHaderNePA4l5F-HKoivGzoLW8uY1a-i41so_E3ySRJgKy_QyAuiZx6v-3IvQ7iA5t/exec";

  // æŠ•ç¨¿è¡¨å•é“¾æ¥
  const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdGgaCCAbhCTAG6G_sxvvzRqnlW_gmEKtHZbprT9XYaHDL3gg/viewform?usp=dialog";

  // åˆå§‹åŒ–åœ°å›¾
  const map = L.map('map').setView([35.549, 139.665], 17);

  // åŠ è½½ OpenStreetMap åº•å›¾
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // è‡ªå®šä¹‰å®ç®± icon
  const treasureIcon = L.icon({
    iconUrl: 'https://cdn.jsdelivr.net/gh/zhuh49092/zoo-treasure@main/images/treasure.png',
    iconSize: [40, 40],
    iconAnchor: [20, 40],
    popupAnchor: [0, -35]
  });

  // åŠ è½½ JSON æ•°æ®å¹¶æ·»åŠ  Marker
  fetch(DATA_URL)
    .then(response => response.json())
    .then(data => {
      data.forEach(point => {
        const [lat, lng] = point["lat/long"].split(',').map(Number);
        const popupContent = `
          <div>
            <img src="${point.image_url}" width="100%" /><br>
            <p>${point.text}</p>
            <a href="${FORM_URL}" target="_blank">â–¶ æŠ•ç¨¿ã—ã¦å®ç®±ã‚’é–‹ã‘ã‚ˆã†ï¼</a>
          </div>
        `;
        const marker = L.marker([lat, lng], { icon: treasureIcon }).addTo(map);
        marker.bindPopup(popupContent);
      });
    })
    .catch(error => {
      console.error("è¯»å– JSON æ•°æ®å¤±è´¥ï¼š", error);
    });

</script>

</body>
</html>
